<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TWC HORECA – Disponibilità</title>
  <link rel="preconnect" href="https://api.thewinecaveau.com" crossorigin>
  <style>
    :root {
      --bg: #0a0a0a;
      --card: #111;
      --muted: #999;
      --text: #f5f5f5;
      --accent: #8a2be2;
      --accent-2: #b889f8;
      --row-pad-y: 6px; /* <— righe più basse */
      --row-pad-x: 10px;
      --radius: 14px;
    }
    html, body { background:#0a0a0a; color:var(--text); margin:0; font: 15px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif; }
    .container{ max-width:1100px; margin:20px auto 80px; padding:0 16px; }
    header{ display:flex; align-items:center; gap:16px; margin:10px 0 12px; }
    header img{ width:40px; height:40px; object-fit:contain; }
    h1{ font-size: clamp(22px, 3.2vw, 32px); margin:0; letter-spacing:.3px; }

    /* Banner contatti */
    .contact-bar{
      display:flex; flex-wrap:wrap; gap:18px; align-items:center;
      background: linear-gradient( to right, rgba(138,43,226,.15), rgba(138,43,226,.05));
      border:1px solid rgba(138,43,226,.35);
      padding:10px 14px; border-radius: var(--radius);
      margin:10px 0 18px;
    }
    .contact-item{ display:flex; align-items:center; gap:8px; color:var(--text); text-decoration:none; }
    .contact-item svg{ width:16px; height:16px; opacity:.85; }
    .contact-item:hover{ text-decoration:underline; }

    .card{ background:var(--card); border:1px solid #1b1b1b; border-radius:var(--radius); padding:14px; }
    .controls{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin-bottom:12px; }
    .controls input, .controls select{ background:#0f0f0f; color:var(--text); border:1px solid #262626; border-radius:10px; padding:8px 10px; }

    table{ width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:12px; }
    thead th{ position:sticky; top:0; background:#151515; z-index:1; text-align:left; font-weight:600; color:#ddd; padding: 10px var(--row-pad-x); border-bottom:1px solid #202020; }
    tbody td{ padding: var(--row-pad-y) var(--row-pad-x); border-bottom:1px dashed #1f1f1f; vertical-align:middle; }
    tbody tr:hover{ background:#141414; }
    .qty-low{ color:#ffb4b4; font-weight:600; }

    /* Pagination moderna con slider */
    .pagination{ display:flex; align-items:center; gap:12px; justify-content:space-between; margin-top:14px; flex-wrap:wrap; }
    .pager-left, .pager-right{ display:flex; align-items:center; gap:8px; }
    .btn{ appearance:none; border:1px solid #2a2a2a; background:#121212; color:#fff; padding:8px 12px; border-radius:10px; cursor:pointer; }
    .btn[disabled]{ opacity:.5; cursor:not-allowed; }
    .range-wrap{ display:flex; align-items:center; gap:10px; min-width:260px; }
    input[type="range"]{ width:220px; accent-color: var(--accent); }
    .page-chip{ background:#171717; border:1px solid #2a2a2a; padding:6px 10px; border-radius:999px; font-size:13px; color:#ddd; }

    footer{ margin:40px auto 0; color:#cfcfcf; }
    footer .foot-card{ background:#111; border:1px solid #1b1b1b; border-radius:12px; padding:16px; white-space:pre-line; font-size:13px; line-height:1.5; color:#cfcfcf; }
    .muted{ color:#a8a8a8; }

    @media (max-width:640px){
      .contact-bar{ gap:12px; }
      thead{ display:none; }
      tbody td{ display:block; padding:10px 12px; }
      tbody tr{ border:1px solid #1f1f1f; border-radius:10px; margin-bottom:10px; display:block; }
      tbody td[data-th]::before{ content: attr(data-th) ": "; color:#a0a0a0; font-weight:500; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img alt="TWC" src="https://shop.thewinecaveau.com/wp-content/uploads/2023/03/Logo-bianco-caveau-copia-2048x2048.png" />
      <h1>HORECA – Disponibilità</h1>
    </header>

    <!-- Banner contatti sotto al titolo -->
    <div class="contact-bar" role="contentinfo" aria-label="Contatti">
      <a class="contact-item" href="tel:+393917011180" title="Chiama +39 391 701 1180">
        <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M6.6 10.8a15.5 15.5 0 006.6 6.6l2.2-2.2a1 1 0 011.1-.2c1.2.5 2.6.8 4 .8a1 1 0 011 1V21a1 1 0 01-1 1C11.2 22 2 12.8 2 2a1 1 0 011-1h4.2a1 1 0 011 1c0 1.4.3 2.8.8 4a1 1 0 01-.2 1.1L6.6 10.8z"/></svg>
        <span>+39 391 701 1180</span>
      </a>
      <a class="contact-item" href="mailto:info@thewinecaveau.com" title="Scrivi a info@thewinecaveau.com">
        <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M20 4H4a2 2 0 00-2 2v12a2 2 0 002 2h16a2 2 0 002-2V6a2 2 0 00-2-2zm0 4.2l-8 5-8-5V6l8 5 8-5v2.2z"/></svg>
        <span>info@thewinecaveau.com</span>
      </a>
    </div>

    <div class="card">
      <div class="controls">
        <input id="search" type="search" placeholder="Cerca produttore / etichetta / formato…" aria-label="Cerca" />
        <select id="riservato">
          <option value="">Tutti</option>
          <option value="NO">Non riservato</option>
          <option value="YES">Riservato</option>
        </select>
        <label class="muted">Per pagina
          <select id="pageSize">
            <option>10</option>
            <option selected>20</option>
            <option>50</option>
            <option>100</option>
          </select>
        </label>
      </div>

      <div class="table-wrap">
        <table id="tbl">
          <thead>
            <tr>
              <th>Produttore</th>
              <th>Etichetta</th>
              <th>Formato</th>
              <th>Quantità</th>
              <th>Box</th>
              <th>Riservato</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>

      <div class="pagination" id="pagination" aria-label="Navigazione pagine">
        <div class="pager-left">
          <button class="btn" id="firstBtn" aria-label="Prima pagina">« Prima</button>
          <button class="btn" id="prevBtn" aria-label="Pagina precedente">‹ Precedente</button>
        </div>
        <div class="range-wrap">
          <span class="page-chip" id="pageInfo">Pagina 1 / 1</span>
          <input type="range" id="pageSlider" min="1" max="1" step="1" value="1" aria-label="Selettore pagina" />
        </div>
        <div class="pager-right">
          <button class="btn" id="nextBtn" aria-label="Pagina successiva">Successivo ›</button>
          <button class="btn" id="lastBtn" aria-label="Ultima pagina">Ultima »</button>
        </div>
      </div>
    </div>

    <footer class="container">
      <div class="foot-card">
© 2025 TWC S.R.L.
P.I. 07388060480
TWC S.R.L. via parrocchia 7 - 25020 FLERO (BS)

Questo sito non fa parte del sito Facebook o Facebook Inc. Inoltre, questo sito NON è approvato da Facebook in alcun modo. FACEBOOK è un marchio registrato di FACEBOOK, Inc.

*This Website is not a part of Facebook or Facebook Inc. Additionally, this site is NOT endorsed by Facebook in any way. FACEBOOK is a trademark of FACEBOOK Inc.
      </div>
    </footer>
  </div>

  <script>
    const API = 'https://api.thewinecaveau.com/availability';

    const qs = (s, root=document) => root.querySelector(s);
    const qsa = (s, root=document) => [...root.querySelectorAll(s)];

    const tbody = qs('#tbody');
    const search = qs('#search');
    const ddlRis = qs('#riservato');
    const pageSizeSel = qs('#pageSize');
    const pageInfo = qs('#pageInfo');
    const slider = qs('#pageSlider');
    const firstBtn = qs('#firstBtn');
    const prevBtn = qs('#prevBtn');
    const nextBtn = qs('#nextBtn');
    const lastBtn = qs('#lastBtn');

    let all = [];
    let filtered = [];
    let currentPage = 1;
    let pageSize = parseInt(pageSizeSel.value, 10) || 20;

    const lowQty = (q) => typeof q === 'number' && q <= 6;

    function toCell(text, th){
      const td = document.createElement('td');
      td.textContent = text ?? '';
      td.setAttribute('data-th', th || '');
      return td;
    }

    function renderTable(){
      tbody.innerHTML = '';
      const start = (currentPage - 1) * pageSize;
      const page = filtered.slice(start, start + pageSize);
      for(const r of page){
        const tr = document.createElement('tr');
        tr.appendChild(toCell(r.produttore, 'Produttore'));
        tr.appendChild(toCell(r.etichetta, 'Etichetta'));
        tr.appendChild(toCell(r.formato, 'Formato'));
        const qty = toCell(r.quantità, 'Quantità');
        if(lowQty(r.quantità)) qty.classList.add('qty-low');
        tr.appendChild(qty);
        tr.appendChild(toCell(r.box, 'Box'));
        tr.appendChild(toCell(r.riservato, 'Riservato'));
        tbody.appendChild(tr);
      }
      updatePager();
    }

    function updatePager(){
      const totalPages = Math.max(1, Math.ceil(filtered.length / pageSize));
      if(currentPage > totalPages) currentPage = totalPages;
      pageInfo.textContent = `Pagina ${currentPage} / ${totalPages}`;
      slider.max = String(totalPages);
      slider.value = String(currentPage);
      prevBtn.disabled = currentPage <= 1;
      firstBtn.disabled = currentPage <= 1;
      nextBtn.disabled = currentPage >= totalPages;
      lastBtn.disabled = currentPage >= totalPages;
    }

    function applyFilters(){
      const q = (search.value || '').toLowerCase();
      const ris = ddlRis.value;
      filtered = all.filter(r => {
        const blob = `${r.produttore} ${r.etichetta} ${r.formato}`.toLowerCase();
        const risOk = ris ? r.riservato === ris : true;
        return blob.includes(q) && risOk;
      });
      currentPage = 1;
      renderTable();
    }

    //— Eventi pagination (fix “Successivo” che non avanzava)
    firstBtn.addEventListener('click', () => { currentPage = 1; renderTable(); });
    prevBtn.addEventListener('click', () => { if(currentPage > 1){ currentPage--; renderTable(); }});
    nextBtn.addEventListener('click', () => {
      const totalPages = Math.max(1, Math.ceil(filtered.length / pageSize));
      if(currentPage < totalPages){ currentPage++; renderTable(); }
    });
    lastBtn.addEventListener('click', () => {
      currentPage = Math.max(1, Math.ceil(filtered.length / pageSize));
      renderTable();
    });
    slider.addEventListener('input', () => { currentPage = parseInt(slider.value, 10) || 1; renderTable(); });

    search.addEventListener('input', applyFilters);
    ddlRis.addEventListener('change', applyFilters);
    pageSizeSel.addEventListener('change', () => { pageSize = parseInt(pageSizeSel.value, 10) || 20; currentPage = 1; renderTable(); });

    async function load(){
      try{
        const res = await fetch(API, { cache: 'no-store' });
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();
        // normalizza chiavi (quantità può arrivare come "quantita")
        all = data.map(r => ({
          produttore: r.produttore ?? r.Produttore ?? '',
          etichetta: r.etichetta ?? r.Etichetta ?? '',
          formato: r.formato ?? r.Formato ?? '',
          quantità: Number(r.quantità ?? r.quantita ?? r.Quantità ?? r.Quantita ?? 0),
          box: r.box ?? r.Box ?? '',
          riservato: r.riservato ?? r.Riservato ?? ''
        }));
        filtered = all.slice();
        renderTable();
      }catch(err){
        console.error('Errore caricamento', err);
        tbody.innerHTML = `<tr><td colspan="6">Errore nel caricamento dati. Riprova più tardi.</td></tr>`;
      }
    }

    load();
  </script>
</body>
</html>
